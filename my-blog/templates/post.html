<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>{{ post.title }}</title>
</head>
<body>
  <h1>{{ post.title }}</h1>
  <p>作者：{{ post.author }}</p>
  <p><small>發布：{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</small></p>
  <hr>
  <div id="content">{{ post.content | e | replace('\n','<br>') | safe }}</div>
  <hr>
  <a href="{{ url_for('index') }}"><button>回到文章列表</button></a>
  <a href="{{ url_for('edit_post_page', post_id=post.id) }}"><button>編輯文章</button></a>
  <button id="delete-btn">刪除文章</button>

  <script>
    document.getElementById('delete-btn').addEventListener('click', async () => {
      if (!confirm('確定要刪除此文章？')) return;
      const res = await fetch(`/api/posts/{{ post.id }}`, {
        method: 'DELETE'
      });
      if (res.ok) {
        alert('已刪除');
        window.location.href = '/';
      } else {
        const err = await res.json();
        alert('刪除失敗：' + (err.error || JSON.stringify(err)));
      }
    });
  </script>
</body>
</html>
